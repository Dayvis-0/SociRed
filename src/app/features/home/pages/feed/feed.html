<app-navbar></app-navbar>

<div class="container">
  <app-sidebar-left></app-sidebar-left>

  <main class="feed">
    <!-- CREATE POST -->
    <div class="create-post">
      <div class="create-post-input" (click)="openCreatePostModal()">
        <div class="create-post-avatar">{{ currentUserInitials }}</div>
        <input 
          type="text" 
          class="create-post-field" 
          [placeholder]="placeholderText"
          readonly
        >
      </div>
    </div>

    <!-- LOADING -->
    <div *ngIf="loading" class="loading-posts">
      <div class="spinner"></div>
      <p>Cargando publicaciones...</p>
    </div>

    <!-- POSTS - ğŸ”‘ AGREGADO trackBy -->
    <article *ngFor="let post of posts; trackBy: trackByPostId" class="post">
      <div class="post-header">
        <div class="post-avatar" [style.background-image]="post.autorPhotoURL ? 'url(' + post.autorPhotoURL + ')' : 'none'">
          <span *ngIf="!post.autorPhotoURL">{{ post.autorInitials }}</span>
        </div>
        <div class="post-info">
          <div class="post-author">{{ post.autorName }}</div>
          <div class="post-time">{{ post.timeAgo }}</div>
        </div>
        
        <!-- Mostrar menÃº solo si es el autor -->
        <div 
          *ngIf="currentUser && post.autorId === currentUser.userId" 
          class="post-menu" 
          (click)="onEdit(post)"
        >
          â‹¯
        </div>
      </div>

      <div class="post-content">{{ post.contenido }}</div>

      <div *ngIf="post.imagenUrl" class="post-image">
        <img [src]="post.imagenUrl" [alt]="'Imagen de ' + post.autorName">
      </div>

      <div class="post-stats">
        <span class="post-likes">{{ post.likes }} Me gusta</span>
        <span class="post-comments">{{ post.commentsCount }} Comentarios</span>
      </div>

      <div class="post-actions">
        <app-like-button
          [liked]="post.isLikedByCurrentUser"
          [likesCount]="post.likes"
          [showCount]="false"
          (likeToggle)="toggleLike(post)"
        ></app-like-button>
        
        <button 
          *ngIf="currentUser && post.autorId === currentUser.userId" 
          class="post-action" 
          (click)="onEdit(post)"
        >
          <span>âœï¸</span>
          <span>Editar</span>
        </button>

        <button 
          *ngIf="currentUser && post.autorId === currentUser.userId" 
          class="post-action post-action-delete" 
          (click)="deletePost(post)"
        >
          <span>ğŸ—‘ï¸</span>
          <span>Eliminar</span>
        </button>
      </div>

      <!-- COMMENT SECTION -->
      <app-comment-section 
        [postId]="post.postId"
        [commentsCount]="post.commentsCount"
      ></app-comment-section>
    </article>

    <!-- EMPTY STATE -->
    <div *ngIf="!loading && posts.length === 0" class="empty-state">
      <p>ğŸ”­</p>
      <h3>No hay publicaciones aÃºn</h3>
      <p>Â¡SÃ© el primero en compartir algo!</p>
    </div>

  </main>

  <app-sidebar-right></app-sidebar-right>
</div>

<!-- CREATE POST MODAL -->
<app-create-post-modal (publishPost)="onPublishPost($event)"></app-create-post-modal>
<div class="comments-section">
  <!-- BotÃ³n para mostrar comentarios existentes -->
  <button class="view-comments-btn" (click)="toggleComments()" *ngIf="commentsCount > 0">
    {{ showComments ? 'Ocultar comentarios' : 'Ver los ' + commentsCount + ' comentario' + (commentsCount !== 1 ? 's' : '') }}
  </button>
  
  <!-- Loading -->
  <div *ngIf="loading" class="comments-loading">
    <span>Cargando comentarios...</span>
  </div>
  
  <!-- Contenedor de comentarios con scroll -->
  <div 
    class="comments-container" 
    [class.show]="showComments" 
    [class.has-scroll]="comments.length > 3"
    *ngIf="showComments && !loading"
  >
    <!-- Comentarios -->
    <div *ngFor="let comment of comments" class="comment-item">
      <div 
        class="comment-avatar"
        [style.background-image]="comment.autorPhotoURL ? 'url(' + comment.autorPhotoURL + ')' : 'none'"
      >
        <span *ngIf="!comment.autorPhotoURL">{{ getInitials(comment.autorName) }}</span>
      </div>
      <div class="comment-content">
        <div class="comment-bubble">
          <span class="comment-author">{{ comment.autorName }}</span>
          <p class="comment-text">{{ comment.texto }}</p>
        </div>
        <div class="comment-actions">
          <button 
            class="comment-like-btn"
            [class.liked]="comment.isLikedByCurrentUser"
            (click)="toggleLike(comment)"
          >
            Me gusta
          </button>
          <button class="comment-reply-btn" (click)="onReply(comment)">
            Responder
          </button>
          <span class="comment-time">{{ comment.timeAgo }}</span>
          <span *ngIf="comment.likes > 0" class="comment-likes">
            {{ comment.likes }} Me gusta
          </span>
        </div>
        
        <!-- Respuestas al comentario -->
        <div *ngIf="comment.replies && comment.replies.length > 0" class="comment-replies">
          <div *ngFor="let reply of comment.replies" class="comment-item reply">
            <div 
              class="comment-avatar"
              [style.background-image]="reply.autorPhotoURL ? 'url(' + reply.autorPhotoURL + ')' : 'none'"
            >
              <span *ngIf="!reply.autorPhotoURL">{{ getInitials(reply.autorName) }}</span>
            </div>
            <div class="comment-content">
              <div class="comment-bubble">
                <span class="comment-author">{{ reply.autorName }}</span>
                <p class="comment-text">{{ reply.texto }}</p>
              </div>
              <div class="comment-actions">
                <button 
                  class="comment-like-btn"
                  [class.liked]="reply.isLikedByCurrentUser"
                  (click)="toggleLike(reply)"
                >
                  Me gusta
                </button>
                <span class="comment-time">{{ reply.timeAgo }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty state -->
    <div *ngIf="comments.length === 0" class="comments-empty">
      <p>No hay comentarios aÃºn. Â¡SÃ© el primero en comentar!</p>
    </div>
  </div>
  
  <!-- Formulario para agregar comentario -->
  <div class="add-comment-form">
    <div 
      class="comment-avatar"
      [style.background-image]="(currentUser && currentUser.photoURL) ? 'url(' + currentUser.photoURL + ')' : 'none'"
    >
      <span *ngIf="!(currentUser && currentUser.photoURL)">{{ currentUserInitials }}</span>
    </div>
    <div class="comment-input-wrapper">
      <input 
        type="text" 
        class="comment-input" 
        placeholder="Escribe un comentario..."
        [(ngModel)]="newCommentText"
        (keypress)="onKeyPress($event)"
      >
      <div class="comment-input-actions">
        <button class="emoji-btn" title="Emoji" (click)="onEmojiClick()">ðŸ˜Š</button>
      </div>
    </div>
  </div>
</div>